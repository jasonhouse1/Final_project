---
title: 資料庫專題-1

---


# **OrderMaster 訂單管理系統 — 期末專題報告**

---

# OrderMaster 訂單管理系統

> 資料庫設計期末專題報告

---

## 目錄

1. 組員分工表
2. 專題研究背景與目標
3. 系統功能與設計重點
4. ER 圖說明
5. 資料表設計（正規化至 3NF）
6. View 與查詢報表成果
7. 索引與效能考量
8. 交易控制機制
9. 儲存程序 (Stored Procedure)
10. 觸發器 (Trigger)
11. 資料一致性與異常處理
12. 安全性設計
13. 查詢效能觀察
14. 系統開發結論

---

## 1. 組員分工表

| 組員姓名       | 負責內容           |
| ---------- | -------------- |
| 邱振營 411631327 | 系統功能設計與流程規劃 、資料表設計與資料建置 、SQL 實作與進階功能撰寫 、文件整理、報表設計與系統測試  |

---

## 2. 主要功能

模擬訂單管理流程，具備：

* 高容錯能力
* 交易控制機制
* 基礎邏輯封裝
* 具備報表分析能力


---

## 3. 系統功能與設計重點

* 顧客管理
* 商品管理（庫存控制）
* 訂單與明細管理
* 交易控制機制（確保完整性）
* 儲存程序（自動計算訂單總額）
* 觸發器（自動扣除商品庫存數量）
* 聚合報表查詢分析（顧客消費、銷售排行）
* 報表視圖整合（方便後續查詢）

---

## 4. ER 圖說明

> ![image](https://hackmd.io/_uploads/Syn-cqR7eg.png)

核心資料表：

* Customers（顧客）
* Products（商品）
* Orders（訂單）
* OrderItems（明細）

關聯邏輯：

* Customers 與 Orders：1對多 (One-to-Many)
* Orders 與 OrderItems：1對多 (One-to-Many)
* Products 與 OrderItems：1對多 (One-to-Many)

---

## 5. 資料表設計（正規化至 3NF）

避免重複與異常依賴

### Customers

| 欄位           | 型別                  | 說明   |
| ------------ | ------------------- | ---- |
| CustomerID   | INT PK              | 顧客編號 |
| CustomerName | VARCHAR(100)        | 顧客名稱 |
| Email        | VARCHAR(100) UNIQUE | 電子郵件 |
| 其餘欄位         | 地址、電話等基本資訊          |      |

### Products

| 欄位                 | 型別                            | 說明   |
| ------------------ | ----------------------------- | ---- |
| ProductID          | INT PK                        | 產品編號 |
| ProductName        | VARCHAR(100)                  | 產品名稱 |
| ProductDescription | TEXT                          | 產品描述 |
| UnitPrice          | DECIMAL                       | 單價   |
| StockQuantity      | INT                           | 庫存數量 |
| 供應商資訊              | SupplierName, SupplierContact |      |

### Orders

| 欄位               | 型別      | 說明    |
| ---------------- | ------- | ----- |
| OrderID          | INT PK  | 訂單編號  |
| CustomerID       | INT FK  | 顧客外鍵  |
| OrderDate        | DATE    | 訂單日期  |
| OrderTotalAmount | DECIMAL | 訂單總金額 |

### OrderItems

| 欄位               | 型別      | 說明   |
| ---------------- | ------- | ---- |
| OrderID          | INT FK  | 訂單編號 |
| ProductID        | INT FK  | 產品編號 |
| PurchaseQuantity | INT     | 購買數量 |
| UnitPrice        | DECIMAL | 單價   |

---

## 6. View 與查詢報表成果

### 報表視圖建立

```sql
CREATE OR REPLACE VIEW OrderDetailView AS
SELECT o.OrderID, o.OrderDate, c.CustomerName, p.ProductName,
       oi.PurchaseQuantity, oi.UnitPrice, 
       (oi.PurchaseQuantity * oi.UnitPrice) AS SubTotal
FROM Orders o
JOIN Customers c ON o.CustomerID = c.CustomerID
JOIN OrderItems oi ON o.OrderID = oi.OrderID
JOIN Products p ON oi.ProductID = p.ProductID;
```

### 報表查詢成果

* 顧客消費金額排行
* 商品銷售排行榜
* 每日訂單營收統計

---

## 7. 索引與效能考量

| 資料表        | 索引欄位                 | 說明            |
| ---------- | -------------------- | ------------- |
| Customers  | Email                | UNIQUE 索引防止重複 |
| Products   | ProductID            | PRIMARY KEY   |
| Orders     | CustomerID           | 外鍵查詢加速        |
| OrderItems | (OrderID, ProductID) | 複合主鍵索引        |

---

## 8. 交易控制機制

```sql
START TRANSACTION;

INSERT INTO Orders (...) VALUES (...);

INSERT INTO OrderItems (...) VALUES (...);

UPDATE Orders SET OrderTotalAmount = ...;

COMMIT;
```

保證訂單與明細一致性，若失敗可Rollback。


---

## 9. 儲存程序 (Stored Procedure)

自動插入訂單並計算總金額：

```sql
CREATE PROCEDURE CreateOrder(
    IN inOrderID INT,
    IN inCustomerID INT,
    IN inOrderDate DATE,
    IN inProductID1 INT, IN inQuantity1 INT, IN inUnitPrice1 DECIMAL(10,2),
    IN inProductID2 INT, IN inQuantity2 INT, IN inUnitPrice2 DECIMAL(10,2)
)
BEGIN
    INSERT INTO Orders (OrderID, CustomerID, OrderDate, OrderTotalAmount)
    VALUES (inOrderID, inCustomerID, inOrderDate, 0);

    INSERT INTO OrderItems (OrderID, ProductID, PurchaseQuantity, UnitPrice)
    VALUES (inOrderID, inProductID1, inQuantity1, inUnitPrice1),
           (inOrderID, inProductID2, inQuantity2, inUnitPrice2);

    UPDATE Orders
    SET OrderTotalAmount = (
        SELECT SUM(PurchaseQuantity * UnitPrice)
        FROM OrderItems
        WHERE OrderID = inOrderID
    )
    WHERE OrderID = inOrderID;
END;

```

---

## 10. 觸發器 (Trigger)

自動扣除庫存數量：

```sql
CREATE TRIGGER ReduceStock AFTER INSERT ON OrderItems
FOR EACH ROW
BEGIN
    UPDATE Products
    SET StockQuantity = StockQuantity - NEW.PurchaseQuantity
    WHERE ProductID = NEW.ProductID;
END;
```

---

## 11. 資料一致性與異常處理

* 外鍵完整性
* UPSERT 
* Transaction 保護一致性
* 異常時可 ROLLBACK

---

## 12. 安全性設計

* NOT NULL 約束
* UNIQUE 約束
* FOREIGN KEY 外鍵一致性
* 透過 Transaction 機制避免錯誤操作造成資料殘缺

---

## 13. 查詢效能觀察

* 正規化避免重複存取
* 索引可有效優化 JOIN 與 WHERE 條件
* 聚合查詢 (SUM、GROUP BY) 具備良好執行效能

---

## 14. 結論

透過模擬訂單管理系統，涵蓋資料庫設計、資料一致性、商業邏輯封裝與進階 SQL 應用，來達成完整資料庫系統實作訓練目標。

* 資料表正規化設計 (3NF)
* 外鍵完整性控制 (Foreign Key)
* 高容錯 UPSERT 插入邏輯
* 交易控制 (Transaction) 確保資料一致性
* 儲存程序 (Stored Procedure) 封裝訂單邏輯
* 觸發器 (Trigger) 自動庫存扣減
* 聚合查詢報表實作 (SUM, GROUP BY, ORDER BY)
* 報表視圖整合 (View)
* 完整測試驗證功能穩定
---
